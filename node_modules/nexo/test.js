/*
 * Test
 */
var settings_file = require('./nexo_cred.json').nexo; // This has to go out out of the moduke

var Nexo = require('./nexo');
var nexo_client = new Nexo(); //to be replaced by new nexo.Socket above thsis module 
var counter = 0;

nexo_client.setConfig(settings_file);

nexo_client.connectTo(connected);

function connected() {
    console.log('CONNECTED TO: ' + nexo_client.host + ':' + nexo_client.port);

    nexo_client.ping(pong);

//    nexo_client.writeTo("system command wylacz 'przek sypialnia'");

}

function pong() {
    console.log('pong');

    nexo_client.readFrom("system command stan 'przek sypialnia'",readData);

}

function readData() {
    counter ++;
    switch (counter) {
        case 10: 
            nexo_client.switchOn("'przek sypialnia'", readData);
            break;
        case 20:
        case 40:
            nexo_client.checkState(" przek sypialnia ", readData);
            break;
        case 30:
            nexo_client.switchOff('przek sypialnia', readData);
            break;
        case 50:
            counter = 0;
        default: 
            nexo_client.poolFrom(readData);
    }
    if (nexo_client.buffer && nexo_client.buffer.length) console.log('RECEIVED DATA ' + counter + ' : ' + nexo_client.buffer);

}

function disconnect() {
    nexo_client.end();
}