/*
 * Test
 */

var debug = require('debug')('test'),
    util = require('util');

var settings_file = require('./nexo_cred.json').nexo; // This has to go out out of the moduke
//debug('Settings ' + util.inspect(settings_file));

var Nexo = require('./nexo');
var nexo_client = new Nexo(); //to be replaced by new nexo.Socket above thsis module 
var counter = 0;

nexo_client.setConfig(settings_file);

nexo_client.connectTo(readDataCallback);

function connected() {
 

}

function pong() {
    debug('pong');

    //nexo_client.readFrom("system command stan 'przek sypialnia'");

}

function readDataCallback(state, data) {
    debug("ReadDataCallback state: " + nexo_client.state + " data: " + data)
    switch (nexo_client.state) {
        case 'disconnected': {
            break;
        }

        case 'connecting': {
            break;
        }

        case 'connected': {
            debug('CONNECTED TO: ' + nexo_client.host + ':' + nexo_client.port);

            //nexo_client.registerReadCallback(readDataCallback);
            //nexo_client.registerErrorCallback(errorCallback);
            //nexo_client.ping(pong);
            //    nexo_client.writeTo("system command wylacz 'przek sypialnia'");

            break;
        }

        case '': {
            /*counter ++;
            switch (counter) {
                case 10: 
                    nexo_client.switchOn("'przek sypialnia'");
                    break;
                case 20:
                case 40:
                    nexo_client.checkState(" przek sypialnia ");
                    break;
                case 30:
                    nexo_client.switchOff('przek sypialnia');
                    break;
                case 50:
                    counter = 0;
                default: 
                    // This is already called automatically nexo_client.poolFrom(readData);
            }*/
            if (nexo_client.buffer && nexo_client.buffer.length) debug('RECEIVED DATA ' + counter + ' : ' + nexo_client.buffer);
        }

        default: {
            debug('Unknown state');
        }
    }
}

function disconnect() {
    nexo_client.end();
}